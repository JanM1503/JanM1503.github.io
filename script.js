(function(){
  const dict = {
    de: {
      'nav.home':'Start','nav.services':'Leistungen','nav.about':'Über uns','nav.contact':'Kontakt','nav.imprint':'Impressum','nav.privacy':'Datenschutz',
      'hero.title':'Transformation neu gedacht',
      'hero.text':'Mit einer einzigartigen Kombination aus strategischem Denken und 30 Jahren Erfahrung in der Unternehmensberatung unterstützen wir Sie bei komplexen Transformationen - pragmatisch, kreativ und mit messbaren Ergebnissen. Wir glauben, dass Transformationen nur dann erfolgreich sind, wenn sie von Menschen getragen werden. Deshalb stellen wir den Menschen ins Zentrum - mit Empathie, Klarheit und Partizipation. Transformation neu gedacht heißt für uns: weniger PowerPoint, mehr Menschen. Weniger Theorie, mehr gemeinsames Machen.',
      'services.title':'Unsere Leistungen',
      'services.lead':'Ein maßgeschneiderter Ansatz, um Ihr Unternehmen sicher durch die Herausforderungen und Komplexitäten von Transformationen zu führen. Mit 30 Jahren Beratungserfahrung durften wir den Erfolg vieler Programme mitgestalten – gern auch mit Ihnen.',
      'services.s1.title':'Transformation Programmdesign & Unterstützung',
      'services.s1.desc':'Wir helfen, Ziele und Prioritäten zu schärfen, Programme aufzusetzen und Governance sowie Maßnahmen bis zur Umsetzung zu definieren.',
      'services.s1.li1':'Zielbild & KPIs','services.s1.li2':'Programmdesign & Set‑up','services.s1.li3':'Mobilisierung der Organisation','services.s1.li4':'Steuerung & Fortschrittsmessung','services.s1.li5':'Projektmanagement',
      'services.s2.title':'Strategie – Definition & Umsetzung','services.s2.desc':'Gemeinsam schlüssige Strategien entwickeln – und erfolgreich zur Wirkung bringen.','services.s2.li1':'Strategiereview','services.s2.li2':'Strategiedesign','services.s2.li3':'Ableitung strategischer Initiativen','services.s2.li4':'Umsetzungsbegleitung',
      'services.s3.title':'Organisation – Design & Implementierung','services.s3.desc':'Strukturen schaffen, die Wert schaffen – passgenau und zukunftssicher.','services.s3.li1':'Organisations‑Redesign','services.s3.li2':'Prozessoptimierung','services.s3.li3':'Implementierungsunterstützung',
      'services.s4.title':'Effizienzsteigerung & Kostenreduktion','services.s4.desc':'Wettbewerbsfähigkeit erhöhen – durch höhere Effizienz und geringere Kosten.','services.s4.li1':'Zielsetzung','services.s4.li2':'Maßnahmendefinition','services.s4.li3':'Umsetzungsbegleitung','services.s4.li4':'Programmsteuerung',
      'services.s5.title':'M&A‑Strategie & Implementierung','services.s5.desc':'Gezielte, wirkungsvolle M&A – von der Idee bis zur Integration.','services.s5.li1':'Target‑Identifikation','services.s5.li2':'Due‑Diligence‑Unterstützung','services.s5.li3':'Pre‑ & Post‑Merger‑Unterstützung',
      'about.title':'Über uns',
      'about.text':'Engagement für Ihren Transformationserfolg.<br><br>Klaus Müller Advisory verfügt über die Fähigkeiten, um Sie sicher durch komplexe Transformationen zu führen – von strategischen Neuausrichtungen bis zu Effizienzsteigerungen. Klaus Müller ist seit 30 Jahren Unternehmensberater, davon über 15 Jahre als Partner bei Roland Berger sowie der Implement Consulting Group. Er hat zahlreiche Unternehmen in unterschiedlichen Branchen bei der Erreichung ihrer Transformationsziele begleitet – stets partnerschaftlich und ergebnisorientiert.<br><br>Regelmäßige Publikationen; 2023 unter den Top‑10 M&A‑Beratern weltweit ausgezeichnet.',
      'about.k1':'30+ Jahre Erfahrung','about.k2':'Top‑10 M&A‑Berater 2023','about.k3':'Partner bei Roland Berger & Implement',
      'contact.title':'Kontakt aufnehmen','contact.namePh':'Ihr Name','contact.mailPh':'Ihre E‑Mail','contact.msgPh':'Ihre Nachricht','contact.send':'Senden',
      'footer.legal':'Rechtliches','footer.connect':'Kontakt',
      'imprint.title':'Impressum',
      'imprint.content':'<strong>Klaus Müller Advisory</strong><br>Klaus Müller GmbH<br>Chrummwisstrasse 29<br>CH – 8700 Küsnacht<br>+41 76 680 5992<br><a href=\"mailto:info@klausmueller.ch\">info@klausmueller.ch</a><br><br>Geschäftsführer: Klaus Müller<br><br>Rechtliche Hinweise: Alle Inhalte dieser Website wurden sorgfältig erstellt. Für die Richtigkeit, Vollständigkeit und Aktualität der Inhalte wird keine Haftung übernommen. Links zu externen Webseiten Dritter liegen ausserhalb unseres Einflusses.',
      'privacy.title':'Datenschutzerklärung',
      'privacy.content':'Wir bearbeiten Personendaten (z. B. Name, E‑Mail, Telefonnummer), die Sie uns über Formulare oder direkte Kontaktaufnahme übermitteln.<br><br><strong>Zweck der Datenbearbeitung:</strong> Bearbeitung von Anfragen, Pflege von Kundenbeziehungen, Versand von Informationen (nur auf Wunsch).<br><strong>Weitergabe an Dritte:</strong> Keine Weitergabe, ausser gesetzlich vorgeschrieben oder zur Vertragserfüllung notwendig.<br><strong>Cookies & Tracking:</strong> Keine Marketing‑Cookies. Standard‑Server‑Logs (IP, Browser, Zeitpunkt) max. 12 Monate.<br><strong>Ihre Rechte:</strong> Auskunft, Berichtigung, Löschung, Einschränkung. Kontakt: <a href=\"mailto:info@klausmueller.ch\">info@klausmueller.ch</a>.<br><strong>Verantwortlicher gemäss DSG:</strong> Klaus Müller Advisory, Chrummwisstrasse 29, 8700 Küsnacht.',
      'form.success':'Danke! Ihre Nachricht wurde erfolgreich gesendet. Wir melden uns zeitnah.',
      'form.error':'Entschuldigung – etwas ist schiefgelaufen. Bitte versuchen Sie es später erneut.',
      'form.error.fields':'Bitte prüfen Sie die markierten Felder.'
    },
    en: {
      'nav.home':'Home','nav.services':'Our Services','nav.about':'About','nav.contact':'Contact','nav.imprint':'Imprint','nav.privacy':'Privacy Policy',
      'hero.title':'Transformation consulting reimagined',
      'hero.text':'With a unique combination of strategic thinking and 30 years of experience in management consulting, we support you in navigating complex transformations - pragmatic, creative, and with measurable results. We believe that transformations are only successful when driven by people. That’s why we put people at the center - with empathy, clarity, and participation. For us, reimagining transformation means: less PowerPoint, more people. Less theory, more doing together.',
      'services.title':'Our Services',
      'services.lead':'A tailored approach to guide your company through the challenges and complexities of transformation. With 30 years of consulting experience, we have contributed to the success of many programmes - we would love to be your partner.',
      'services.s1.title':'Transformation programme design & support',
      'services.s1.desc':'We sharpen objectives and priorities, set up the programme and its governance, and define measures through to implementation.',
      'services.s1.li1':'Goal setting & KPIs','services.s1.li2':'Programme design & set‑up','services.s1.li3':'Organisational mobilisation','services.s1.li4':'Steering & progress tracking','services.s1.li5':'Project management',
      'services.s2.title':'Strategy definition & implementation','services.s2.desc':'Co‑creating winning strategies - and making them succeed.','services.s2.li1':'Strategy review','services.s2.li2':'Strategy design','services.s2.li3':'Deriving strategic initiatives','services.s2.li4':'Implementation support',
      'services.s3.title':'Organisational design & implementation','services.s3.desc':'Designing organisations that are fit for purpose - and help you win.','services.s3.li1':'Organisational redesign','services.s3.li2':'Process optimisation','services.s3.li3':'Implementation support',
      'services.s4.title':'Efficiency improvement & cost reduction','services.s4.desc':'Boosting competitiveness through greater efficiency and lower cost.','services.s4.li1':'Target setting','services.s4.li2':'Measure definition','services.s4.li3':'Implementation support','services.s4.li4':'Programme steering',
      'services.s5.title':'M&A strategy & implementation support','services.s5.desc':'Helping companies excel through targeted and effective M&A.','services.s5.li1':'Target identification','services.s5.li2':'Due‑diligence support','services.s5.li3':'Pre‑ and post‑merger support',
      'about.title':'About',
      'about.text':'Committed to your transformation success.<br><br>Klaus Müller Advisory brings the capabilities required to guide you safely through complex transformations - from strategic realignments to efficiency improvements. Klaus Müller has 30 years of consulting experience, including over 15 years as a Partner at Roland Berger and Implement Consulting Group. He has supported numerous companies across industries in achieving their transformation goals - always in a collaborative and results‑oriented way.<br><br>Regularly published; ranked among the Top 10 global M&A consultants in 2023.',
      'about.k1':'30+ years of experience','about.k2':'Top‑10 M&A consultant 2023','about.k3':'Partner at Roland Berger & Implement',
      'contact.title':'Get in touch','contact.namePh':'Your name','contact.mailPh':'Your email','contact.msgPh':'Your message','contact.send':'Send',
      'footer.legal':'Legal','footer.connect':'Contact',
      'imprint.title':'Imprint',
      'imprint.content':'<strong>Klaus Müller Advisory</strong><br>Klaus Müller GmbH<br>Chrummwisstrasse 29<br>CH – 8700 Küsnacht<br>+41 76 680 5992<br><a href=\"mailto:info@klausmueller.ch\">info@klausmueller.ch</a><br><br>Managing Director: Klaus Müller<br><br>Legal notice: The content of this website has been created with care. No liability is assumed for correctness, completeness or timeliness. We are not responsible for external links.',
      'privacy.title':'Privacy Policy',
      'privacy.content':'We process personal data (e.g. name, email address, phone number) that you provide via forms or direct contact.<br><br><strong>Purpose:</strong> Handling enquiries, maintaining client relationships, sending information (only upon request).<br><strong>Disclosure:</strong> No disclosure to third parties unless required by law or necessary to perform a contract.<br><strong>Cookies & tracking:</strong> No marketing cookies. Standard server logs (IP, browser, timestamp) are retained for up to 12 months.<br><strong>Your rights:</strong> Access, rectification, erasure, restriction. Contact: <a href=\"mailto:info@klausmueller.ch\">info@klausmueller.ch</a>.<br><strong>Controller under Swiss data protection law:</strong> Klaus Müller Advisory, Chrummwisstrasse 29, 8700 Küsnacht.',
      'form.success':'Thank you! Your message was sent successfully. We will get back to you shortly.',
      'form.error':'Sorry-something went wrong. Please try again later.',
      'form.error.fields':'Please check the highlighted fields.'
    }
  };

  function getLang(){ return localStorage.getItem('kma_lang') || 'de'; }
  function setLang(l){ localStorage.setItem('kma_lang', l); }

  let lang = getLang();

  function applyI18n(){
    document.querySelectorAll('[data-i18n]').forEach(el=>{
      const k = el.getAttribute('data-i18n'); const v = dict[lang][k];
      if(typeof v==='string') el.innerHTML = v;
    });
    document.querySelectorAll('[data-i18n-ph]').forEach(el=>{
      const k = el.getAttribute('data-i18n-ph'); const v = dict[lang][k];
      if(typeof v==='string') el.setAttribute('placeholder', v);
    });
    const btn = document.getElementById('langToggle'); if(btn) btn.textContent = (lang==='de')?'EN':'DE';
    document.documentElement.lang = lang;

    // Update form status to selected language if already present
    const statusEl = document.getElementById('formStatus');
    if(statusEl && statusEl.dataset.state){
      const key = statusEl.dataset.state === 'success' ? 'form.success' : (statusEl.dataset.state === 'error-fields' ? 'form.error.fields' : 'form.error');
      statusEl.textContent = dict[lang][key];
    }
  }

  document.addEventListener('DOMContentLoaded', ()=>{
    applyI18n();
    const btn = document.getElementById('langToggle');
    if(btn){ btn.addEventListener('click', ()=>{ lang = (lang==='de')?'en':'de'; setLang(lang); applyI18n(); }); }


    document.title = "Klaus Müller Advisory";

    // Sticky header shadow toggle
    const header = document.querySelector('.site-header');
    window.addEventListener('scroll', ()=>{
      if(window.scrollY>8) header.classList.add('is-scrolled'); else header.classList.remove('is-scrolled');
    });

    // Formspree submission with JSON
    const form = document.querySelector('form[action^="https://formspree.io"]');
    const statusEl = document.getElementById('formStatus');
    if(form && statusEl){
      form.addEventListener('submit', async (e)=>{
        e.preventDefault();
        statusEl.textContent = '';
        statusEl.removeAttribute('data-state');
        form.querySelectorAll('.is-error').forEach(el => el.classList.remove('is-error'));
        const payload = { name: form.elements['name']?.value || '', email: form.elements['email']?.value || '', message: form.elements['message']?.value || '' };
        try{
          const resp = await fetch(form.action, { method:'POST', headers:{'Accept':'application/json','Content-Type':'application/json'}, body: JSON.stringify(payload) });
          if(resp.ok){
            form.reset();
            statusEl.className = 'form-status success';
            statusEl.dataset.state = 'success';
            statusEl.textContent = dict[lang]['form.success'];
          }else{
            statusEl.className = 'form-status error';
            const data = await resp.json().catch(()=>null);
            if(data && data.errors){
              data.errors.forEach(err => { const field = err.field && form.elements[err.field]; if(field) field.classList.add('is-error'); });
              statusEl.dataset.state = 'error-fields';
              statusEl.textContent = dict[lang]['form.error.fields'];
            }else{
              statusEl.dataset.state = 'error';
              statusEl.textContent = dict[lang]['form.error'];
            }
          }
        }catch(err){
          statusEl.className = 'form-status error';
          statusEl.dataset.state = 'error';
          statusEl.textContent = dict[lang]['form.error'];
        }
      });
    }
  });
})();


// === Fade-in on scroll ===
document.addEventListener("DOMContentLoaded", () => {
  const faders = document.querySelectorAll('.fade-in-section');
  const observer = new IntersectionObserver((entries, obs) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('visible');
        obs.unobserve(entry.target); // animate only once
      }
    });
  }, { threshold: 0.2 });

  faders.forEach(el => observer.observe(el));
});
